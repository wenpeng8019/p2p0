# P2P Zero

[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)
[![C99](https://img.shields.io/badge/C-99-blue.svg)](https://en.wikipedia.org/wiki/C99)
[![Zero Dependencies](https://img.shields.io/badge/Dependencies-Zero-green.svg)](#é›¶ä¾èµ–)

**é›¶ä¾èµ–çš„ P2P é€šä¿¡åº“**ï¼Œçº¯ C99 å®ç°ï¼Œæ— éœ€ä»»ä½•å¤–éƒ¨åº“å³å¯å®Œæˆ NAT ç©¿é€å’Œç‚¹å¯¹ç‚¹é€šä¿¡ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Alice  â”‚ â—„â”€â”€â”€â”€â”€ P2P ç›´è¿ â”€â”€â”€â”€â”€â–º   â”‚   Bob   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                                      â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º NAT ç©¿é€ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ç‰¹æ€§

- **ğŸ¯ é›¶ä¾èµ–** â€” æ ¸å¿ƒåŠŸèƒ½æ— éœ€ä»»ä½•ç¬¬ä¸‰æ–¹åº“ï¼Œå¼€ç®±å³ç”¨
- **ğŸŒ NAT ç©¿é€** â€” æ”¯æŒ STUN/ICE (RFC 5245)ï¼Œè‡ªåŠ¨æ£€æµ‹ NAT ç±»å‹
- **ğŸ“¡ å¤šç§ä¿¡ä»¤** â€” è‡ªå»ºæœåŠ¡å™¨ / GitHub Gistï¼ˆæ— æœåŠ¡å™¨æˆæœ¬ï¼ï¼‰
- **ğŸ”„ å¯é ä¼ è¾“** â€” å†…ç½® ARQ é‡ä¼ å’Œæµæ§ï¼Œå­—èŠ‚æµè¯­ä¹‰
- **ğŸ”’ å¯é€‰åŠ å¯†** â€” DTLS æ”¯æŒï¼ˆMbedTLS / OpenSSLï¼ŒæŒ‰éœ€ç¼–è¯‘ï¼‰
- **ğŸ“¦ æ¨¡å—åŒ–è®¾è®¡** â€” ä¼ è¾“å±‚å¯æ’æ‹”ï¼Œæ”¯æŒ PseudoTCP / SCTP

## å¿«é€Ÿå¼€å§‹

### ç¼–è¯‘

```bash
# åŸºç¡€ç¼–è¯‘ï¼ˆé›¶ä¾èµ–ï¼‰
make

# æˆ–ä½¿ç”¨ CMake
mkdir build && cd build
cmake ..
make
```

### è¿è¡Œç¤ºä¾‹

**æ–¹å¼ä¸€ï¼šä½¿ç”¨ä¿¡ä»¤æœåŠ¡å™¨**

```bash
# ç»ˆç«¯ 1ï¼šå¯åŠ¨ä¿¡ä»¤æœåŠ¡å™¨
./build_cmake/p2p_server/p2p_server 8888

# ç»ˆç«¯ 2ï¼šAliceï¼ˆè¢«åŠ¨ç­‰å¾…ï¼‰
./build_cmake/p2p_ping/p2p_ping --name alice --server 127.0.0.1

# ç»ˆç«¯ 3ï¼šBobï¼ˆä¸»åŠ¨è¿æ¥ï¼‰
./build_cmake/p2p_ping/p2p_ping --name bob --server 127.0.0.1 --to alice
```

**æ–¹å¼äºŒï¼šä½¿ç”¨ GitHub Gistï¼ˆé›¶æœåŠ¡å™¨ï¼‰**

```bash
# ç»ˆç«¯ 1ï¼šAliceï¼ˆè®¢é˜…è€…ï¼‰
./build_cmake/p2p_ping/p2p_ping --name alice --github YOUR_TOKEN --gist YOUR_GIST_ID

# ç»ˆç«¯ 2ï¼šBobï¼ˆå‘å¸ƒè€…ï¼‰
./build_cmake/p2p_ping/p2p_ping --name bob --github YOUR_TOKEN --gist YOUR_GIST_ID --to alice
```

## é›¶ä¾èµ–

æ ¸å¿ƒ P2P åŠŸèƒ½å®Œå…¨è‡ªåŒ…å«ï¼š

| ç»„ä»¶ | è¯´æ˜ | ä¾èµ– |
|------|------|------|
| NAT ç©¿é€ | STUN/ICE åè®®å®ç° | æ—  |
| ä¿¡ä»¤åè®® | SIMPLE/RELAY æ¨¡å¼ | æ—  |
| å¯é ä¼ è¾“ | ARQ + æµæ§ | æ—  |
| æ•°æ®åˆ†ç‰‡ | è‡ªåŠ¨åˆ†åŒ…é‡ç»„ | æ—  |

å¯é€‰åŠŸèƒ½ï¼ˆæŒ‰éœ€ç¼–è¯‘ï¼‰ï¼š

| åŠŸèƒ½ | ä¾èµ– | ç¼–è¯‘é€‰é¡¹ |
|------|------|----------|
| DTLS åŠ å¯† | MbedTLS æˆ– OpenSSL | `WITH_DTLS=1` |
| SCTP ä¼ è¾“ | usrsctp | `WITH_SCTP=1` |
| GitHub ä¿¡ä»¤ | libcurl | `WITH_CURL=1` |

## API ç¤ºä¾‹

```c
#include <p2p.h>

int main() {
    p2p_config_t cfg = {0};
    cfg.server_host = "127.0.0.1";
    cfg.server_port = 8888;
    strncpy(cfg.local_peer_id, "alice", P2P_PEER_ID_MAX);
    
    p2p_session_t *s = p2p_create(&cfg);
    p2p_connect(s, "bob");
    
    // ç­‰å¾…è¿æ¥
    while (p2p_state(s) != P2P_STATE_CONNECTED) {
        p2p_update(s);
        usleep(10000);
    }
    
    // å‘é€/æ¥æ”¶æ•°æ®
    p2p_send(s, "Hello!", 6);
    
    char buf[256];
    int n = p2p_recv(s, buf, sizeof(buf));
    
    p2p_destroy(s);
    return 0;
}
```

## ä¿¡ä»¤æ¨¡å¼

| æ¨¡å¼ | ä¿¡ä»¤æ–¹å¼ | æœåŠ¡å™¨è¦æ±‚ | é€‚ç”¨åœºæ™¯ |
|------|---------|-----------|---------|
| **SIMPLE** | UDP æ— çŠ¶æ€ | p2p_server | è½»é‡çº§åº”ç”¨ |
| **ICE** | TCP é•¿è¿æ¥ | p2p_server | ç”Ÿäº§ç¯å¢ƒ |
| **PUBSUB** | GitHub Gist | æ—  | æ¼”ç¤º/æµ‹è¯• |

è¯¦è§ [CONNECT_API.md](CONNECT_API.md)

## æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åº”ç”¨å±‚ (p2p_ping)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              å…¬å…± API (p2p.h)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ä¼ è¾“å±‚                   â”‚     ä¿¡ä»¤å±‚         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Stream (å­—èŠ‚æµ)     â”‚   â”‚  â”‚ SIMPLE      â”‚   â”‚
â”‚  â”‚ Reliable (ARQ)      â”‚   â”‚  â”‚ RELAY (ICE) â”‚   â”‚
â”‚  â”‚ PseudoTCP (æ‹¥å¡)    â”‚   â”‚  â”‚ PUBSUB      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   NAT ç©¿é€å±‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   STUN    â”‚ â”‚    ICE    â”‚ â”‚  NAT Detect   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              UDP å¥—æ¥å­—å±‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

è¯¦è§ [ARCHITECTURE.md](ARCHITECTURE.md)

## æµ‹è¯•

```bash
cd test

# å•å…ƒæµ‹è¯•
make && ./test_transport && ./test_compact_server && ./test_relay_server

# é›†æˆæµ‹è¯•
./test_client_integration.sh
./test_nat_punch.sh

# PubSub æµ‹è¯•
./test_pubsub_gist.sh
```

è¯¦è§ [test/README.md](test/README.md)

## é¡¹ç›®ç»“æ„

```
p2p/
â”œâ”€â”€ include/p2p.h          # å…¬å…± API
â”œâ”€â”€ p2p.c                  # æ ¸å¿ƒå®ç°
â”œâ”€â”€ p2p_stun.c             # STUN åè®®
â”œâ”€â”€ p2p_ice.c              # ICE åè®® (RFC 5245)
â”œâ”€â”€ p2p_nat_detect.c       # NAT ç±»å‹æ£€æµ‹
â”œâ”€â”€ p2p_reliable.c         # å¯é ä¼ è¾“ (ARQ)
â”œâ”€â”€ p2p_stream.c           # å­—èŠ‚æµå±‚
â”œâ”€â”€ p2p_signal*.c          # ä¿¡ä»¤åè®®
â”œâ”€â”€ p2p_ping/              # æµ‹è¯•å·¥å…·
â”œâ”€â”€ p2p_server/            # ä¿¡ä»¤æœåŠ¡å™¨
â””â”€â”€ test/                  # æµ‹è¯•å¥—ä»¶
```

## æ–‡æ¡£

- [ARCHITECTURE.md](ARCHITECTURE.md) â€” æ¶æ„è®¾è®¡
- [CONNECT_API.md](CONNECT_API.md) â€” è¿æ¥ API æŒ‡å—
- [p2p_protocol.md](p2p_protocol.md) â€” åè®®è§„èŒƒ
- [test/README.md](test/README.md) â€” æµ‹è¯•æŒ‡å—

## æ„å»ºé€‰é¡¹

| é€‰é¡¹ | è¯´æ˜ | é»˜è®¤ |
|------|------|------|
| `THREADED` | å†…éƒ¨çº¿ç¨‹æ¨¡å¼ | OFF |
| `WITH_DTLS` | MbedTLS åŠ å¯† | OFF |
| `WITH_OPENSSL` | OpenSSL åŠ å¯† | OFF |
| `WITH_SCTP` | usrsctp ä¼ è¾“ | OFF |
| `WITH_CURL` | libcurl (GitHub ä¿¡ä»¤) | OFF |

```bash
# å¯ç”¨åŠ å¯†
cmake .. -DWITH_DTLS=ON
make

# å¯ç”¨çº¿ç¨‹
cmake .. -DTHREADED=ON
make
```

## è®¸å¯è¯

MIT License

---

*Zero dependencies. Maximum connectivity.*
